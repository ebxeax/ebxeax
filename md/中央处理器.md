# 中央处理器
控制器：负责协调并控制计算机各部件执行程序的指令序列：取指令、分析指令、执行指令  
运算器：对数据加工
- 指令控制
- 操作控制
- 数据加工
- 时间控制
- 中断处理

### 基本结构
运算器和控制器两大部分组成  
运算器：
- 算术逻辑单元（ALU）
- 暂存寄存器
- 累加寄存器（ACC）
- 通用寄存器组（AX/BX/CX/DX/SP）
- 程序状态字寄存器（PSW：OF/SF/ZF/CF）
- 移位器
- 计数器

控制器（CU）：
- 程序计数器（PC）
- 指令寄存器（IR）
- 指令译码器
- 存储器地址寄存器
- 存储器数据寄存器
- 时序系统
- 微操作信号发生器

## 指令执行过程
### 指令周期
CPU从主存取出并执行一条指令的时间，指令周期通常使用若干机器周期表示，每个机器周期可等长或不等，一个机器周期包含若干时钟周期（节拍），每个机器周期内的时钟周期数可以不等
- 无条件转移指令：执行阶段不需要访存，只包含取指阶段（取指和分析）和执行阶段
- 间接寻址指令：为了取操作数，需要先访1次，取出有效地址，然后访存，取出操作数，所有需要包含间址周期，介于取指和执行之间
- CPU采用中断方式实现主机和I/O设备的信息交换，CPU在每条指令结束前，都要发送中断查询信号，若有中断请求，CPU进入中断响应阶段（中断周期）

|||||
|-|-|-|-|
|取指周期|间址周期|执行周期|中断周期|

只有访存的目的不同，取指周期是为了取指令，间址周期是为了取有效地址，执行周期是为了取操作数，中断周期是为了保存程序断点  
CPU内设置了4个标志触发器FE/IND/EX/INT

|FE|IND|EX|INT|
|-|-|-|-|
|Fetch|Index|Execute|Interrupt|
|取值|间址|执行|中断|

### 指令周期的数据流
#### 取指周期
根据PC中的内容从主存取出指令代码放入IR  
- PC $\to$ IR $\to$ AddrBus $\to$ Mem
- CU $\to$ DataBus $\to$ MDR $\to$ Mem
- Mem $\to$ DataBus $\to$ MDR $\to$ IR（存放指令）
- CU $\stackrel{SignalControl::FE}{\longrightarrow}$ [(PC) + 1 $\to$ PC]

#### 间址周期
取操作数有效地址，间址为例：指令中的地址码送到MAR并送至地址总线，CU向存储器发送读命令，以获取有效地址并存在MDR  
- Addr(IR) / MDR $\to$ MAR $\to$ AddrBus $\to$ Mem
- CU $\stackrel{SignalI/O::READ}{\longrightarrow}$ ControlBus $\to$ Mem（存放有效地址）
- Mem $\to$ DataBus $\to$ MDR

#### 执行周期
取操作数，根据IR的指令字的操作码通过ALU操作产生执行结果
- 无统一的数据流向

#### 中断周期
处理中断请求，假设程序断点存入堆栈，用SP指示栈顶地址，入栈操作是先修改栈顶指针，后存入数据
- CU $\stackrel{SignalStack::SP}{\longrightarrow}$ [(SP) - 1 $\to$ SP] $\to$ MAR $\to$ AddrBus $\to$ Mem
- CU $\stackrel{SignalI/O::WRITE}{\longrightarrow}$ ControlBus $\to$ Mem
- PC $\to$ MDR $\to$ DataBus $\to$ Mem（程序断点存入主存）
- CU $\to$ PC（中断服务程序的入口地址送至PC）

### 指令执行方案
- 单指令周期
- 多指令周期
- 流水线方案

## 数据通路
### 功能
数据通路：数据在功能部件之间传输的路径  
由控制部件控制，控制部件根据每条指令功能的不同生成对数据通路的控制信号   
数据通路功能：实现CPU内部的运算器与寄存器以及寄存器之间的数据交换

### 基本结构
- CPU内部单总线模式  
所有寄存器的输入输出端都连接在一条公共通路上，结构简单但数据传输存在较多的冲突现象，性能较低。连接各部件的总线只有一条时，称为单总线结构，CPU中有两条或更多的总线时，构成双总线结构或多总线结构
- CPU内部多总线模式  
所有寄存器的输入输出端都连接在多条公共通路上，相比之下单总线在一个时钟内只允许传一个数据，因此指令执行效率很低，因此在多总线方式，同时在多总线上传输不同的数据，提高效率
- 专用数据通路方式  
根据指令执行过程中的数据和地址的流动方向安排连接线路，避免使用共享的总线，性能较高，但硬件量大

#### 寄存器之间的数据传输
通过内部总线完成  
寄存器AX的输入输出由AXout和AXin控制  

- (PC) $\to$ MAR，PCout和MARin有效


#### 主存与CPU之间的数据传输
主存与CPU之间的数据传输需要借助CPU内部总线完成  
主存内读取

- (PC) $\to$ MAR，PCout和MARin有效  
- 1 $\to$ R，CU发出读命令  
- MEM(MAR) $\to$ MDR，MDRin有效  
- (MDR) $\to$ IR，MDRout和IRin有效  

#### 执行算术或逻辑算术
由于ALU没有内部存储功能，执行加法操作，相加的两个数必须在ALU的两个输入输出端同时有效

- (MDR) $\to$ MAR，MDRout和MARin有效  
- 1 $\to$ R，CU读命令
- MEM(MAR) $\to$ 操作数从主存送至MDR
- (MDR) $\to$ Y，MDRout和Yin有效
- (ACC) + (Y) $\to$ Z ACCout和ALUin有效
- (Z) $\to$ ACC，Zout和ACCin有效

## 控制器功能与原理
### 结构和功能
- 运算器部件通过数据总线与内存储器、输入设备和输出设备传送数据
- 输入设备和输出设备通过接口电路与总线相连接
- 内存储器、输入设备通过接口电路与总线相连接
- 内存储器、输入设备和输出设备从地址总线接收地址信息，从控制总线得到控制信号，通过数据总线与其他部件传输数据
- 控制器部件从数据总线接受指令信息，从运算器部件接收指令转移地址，送出指令地址到地址总线，还要向系统中的部件通过运算所需的控制信号


控制器功能：
- 从主存取指令，并指出下一条指令在主存中的位置
- 对指令进行译码或测试，产生相应的操作控制信号，以便启动规定的动作
- 指挥并控制CPU、主存、输入输出设备之间的数据流动方向


根据控制器产生微操作控制信号的方式不同，控制器可分为
- 硬布线控制器
- 微程序控制器

两类控制器的PC和IR是相同的，但确定和表示指令执行步骤的办法以及给出控制部件各部件运算所需控制信号的方案不同

### 硬布线控制器
- 根据指令的要求、当前的时序及外部和内部的状态，按时间的顺序发送一系列微操作控制信号
- 由复杂的组合逻辑门电路和一些触发器构成

